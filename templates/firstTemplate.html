<!DOCTYPE html>
<html>
<head>
    <title>클릭으로 팝업 드롭다운 메뉴 예제</title>
    <style>
        /* 드롭다운 메뉴 스타일 */
        .dropdown-menu {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 300px;
            padding: 8px;
            border: 1px solid #ccc;
            z-index: 1;
        }

        .sub-content {
            z-index: 2;
        }

        /* 서브 메뉴 이름 스타일 */
        .sub-menu-name {
            display: inline-flex; /* 가로로 정렬 */
            align-items: center; /* 세로 중앙 정렬 */
            margin-right: 8px;
            /* 가로 정렬 추가 */
            white-space: nowrap;
        }

        /* 서브 메뉴 버튼 스타일 */
        .sub-menu {
            display: inline-flex; /* 가로로 정렬 */
            align-items: center; /* 세로 중앙 정렬 */
            /* 가로 정렬 추가 */
            vertical-align: middle;
        }

        /* 숫자와 버튼을 한 줄에 나오게 스타일 수정 */
        .sub-menu-name span,
        .sub-menu {
            display: inline-block;
            vertical-align: middle;
        }
    </style>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
</head>
<body>
    <h1>클릭으로 팝업 드롭다운 메뉴 예제</h1>

    <div>
        <input type="text" name="daterange" value="" />

        <script>
            $(function() {
              var drp = $('input[name="daterange"]').daterangepicker({
                opens: 'left'
              }, function(start, end, label) {
                console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
              });
            });
        </script>
    </div>
    
    {% for category, sub_menus in sub_menu_names.items() %}
    <div class="dropdown-menu {{ category }} ">
        <button>{{ category }}</button>
        <div class="dropdown-content {{ category }}">
            <p>{{ category }}의 내용입니다.</p>
            {% for sub_menu, sub_values in sub_menus.items() %}
            <div class="sub-menu-name sub_menu">
                <span>{{ sub_menu }}</span>
            </div>
            <select class="sub-menu" onchange="showSubContent('{{ category }}', this.value)">
                <option value="">서브 메뉴 선택</option>
                {% for sub_value in sub_values %}
                <option value="{{ sub_value }}">{{ sub_value }}</option>
                {% endfor %}
            </select>
            <br/>
            {% endfor %}
        </div>
    </div>
    {% endfor %}

    <div>
        <button class="submit">예측</button>
    </div>

    <script>
        // JSON 출력을 위한 이벤트 핸들러 추가
        document.querySelector(".submit").addEventListener("click", function () {
            const selectedOptions = {};
            const dropdownMenus = document.querySelectorAll(".sub-menu");
    
            dropdownMenus.forEach((select) => {
                const category = select.parentElement.className.split(" ")[1];
                const selectedSubmenu = select.value;
                const inputValue = select.nextElementSibling.value; // 새로 추가된 input 요소의 값을 읽어옴
                
                if (selectedSubmenu !== "") {
                    if (!selectedOptions[category]) {
                        selectedOptions[category] = [];
                    }
                    selectedOptions[category].push({ subMenu: selectedSubmenu, value: inputValue });
                }
            });
    
            // 선택한 옵션들을 JSON 형태로 출력
            console.log(JSON.stringify(selectedOptions));
        });
    </script>

    <script>
        // 팝업 드롭다운 메뉴 표시/감추기
        const dropdownMenus = document.querySelectorAll(".dropdown-menu button");

        dropdownMenus.forEach((button) => {
            button.addEventListener("click", (event) => {
                const dropdownContent = event.target.nextElementSibling;
                dropdownContent.style.display = dropdownContent.style.display === "block" ? "none" : "block";
                event.stopPropagation();
            });
        });

        // 문서의 다른 부분 클릭 시 드롭다운 메뉴 감추기
        document.addEventListener("click", (event) => {
            const allDropdownContents = document.querySelectorAll(".dropdown-content");
            allDropdownContents.forEach((content) => {
                // 클릭된 내용과 해당 메뉴의 버튼은 닫지 않도록 처리
                if (content.contains(event.target) || event.target.classList.contains("sub-menu")) {
                    return;
                }
                content.style.display = "none";
            });
        });

        function showSubContent(category, selectedSubmenu) {
            const subContentPlaceholder = document.querySelector(`.dropdown-content.${category} .sub-content-placeholder`);
            const selectedSubContent = document.querySelector(`.dropdown-content.${category} .sub-content.${selectedSubmenu}`);

            if (selectedSubContent) {
                subContentPlaceholder.style.display = "none";
                selectedSubContent.style.display = "block";
            } else {
                subContentPlaceholder.style.display = "block";
            }
        }
    </script>
</body>
</html>